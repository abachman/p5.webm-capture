(()=>{var Wt=Object.create;var st=Object.defineProperty;var Rt=Object.getOwnPropertyDescriptor;var Ot=Object.getOwnPropertyNames;var qt=Object.getPrototypeOf,zt=Object.prototype.hasOwnProperty;var Vt=y=>st(y,"__esModule",{value:!0});var Nt=(y,d)=>()=>(d||y((d={exports:{}}).exports,d),d.exports);var Ht=(y,d,O,j)=>{if(d&&typeof d=="object"||typeof d=="function")for(let i of Ot(d))!zt.call(y,i)&&(O||i!=="default")&&st(y,i,{get:()=>d[i],enumerable:!(j=Rt(d,i))||j.enumerable});return y},jt=(y,d)=>Ht(Vt(st(y!=null?Wt(qt(y)):{},"default",!d&&y&&y.__esModule?{get:()=>y.default,enumerable:!0}:{value:y,enumerable:!0})),y);var yt=Nt((it,rt)=>{(function(){"use strict";var y=!1,d=window.Tar,O=window.download,j=window.GIF,i=window.WebMWriter,u={function:!0,object:!0};function g(e){return e&&e.Object===Object?e:null}var q=parseFloat,G=parseInt,E=u[typeof it]&&it&&!it.nodeType?it:void 0,z=u[typeof rt]&&rt&&!rt.nodeType?rt:void 0,X=z&&z.exports===E?E:void 0,Q=g(E&&z&&typeof global=="object"&&global),c=g(u[typeof self]&&self),t=g(u[typeof window]&&window),h=g(u[typeof this]&&this),n=Q||t!==(h&&h.window)&&t||c||h||Function("return this")();"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,r,B){for(var b=atob(this.toDataURL(r,B).split(",")[1]),Y=b.length,x=new Uint8Array(Y),N=0;N<Y;N++)x[N]=b.charCodeAt(N);e(new Blob([x],{type:r||"image/png"}))}});(function(){if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}})();function f(e){return String("0000000"+e).slice(-7)}var v=window.Date.now();function I(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function l(e){var r={};this.settings=e,this.on=function(B,b){r[B]=b},this.emit=function(B){var b=r[B];b&&b.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=e.name||I(),this.extension="",this.mimeType=""}l.prototype.start=function(){},l.prototype.stop=function(){},l.prototype.add=function(){},l.prototype.save=function(){},l.prototype.dispose=function(){},l.prototype.safeToProceed=function(){return!0},l.prototype.step=function(){console.log("Step not set!")};function w(e){l.call(this,e),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.baseFilename=this.filename,this.tape=null,this.count=0,this.part=1,this.frames=0}w.prototype=Object.create(l.prototype),w.prototype.start=function(){this.dispose()},w.prototype.add=function(e){var r=new FileReader;r.onload=function(){this.tape.append(f(this.count)+this.fileExtension,new Uint8Array(r.result)),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(B){this.filename=this.baseFilename+"-part-"+f(this.part),O(B,this.filename+this.extension,this.mimeType);var b=this.count;this.dispose(),this.count=b+1,this.part++,this.filename=this.baseFilename+"-part-"+f(this.part),this.frames=0,this.step()}.bind(this)):(this.count++,this.frames++,this.step())}.bind(this),r.readAsArrayBuffer(e)},w.prototype.save=function(e){e(this.tape.save())},w.prototype.dispose=function(){this.tape=new d,this.count=0};function k(e){w.call(this,e),this.type="image/png",this.fileExtension=".png"}k.prototype=Object.create(w.prototype),k.prototype.add=function(e){e.toBlob(function(r){w.prototype.add.call(this,r)}.bind(this),this.type)};function K(e){w.call(this,e),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=e.quality/100||.8}K.prototype=Object.create(w.prototype),K.prototype.add=function(e){e.toBlob(function(r){w.prototype.add.call(this,r)}.bind(this),this.type,this.quality)};function F(e){var r=document.createElement("canvas");r.toDataURL("image/webp").substr(5,10)!=="image/webp"&&console.log("WebP not supported - try another export format"),l.call(this,e),this.quality=e.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=e.framerate,this.frames=0,this.part=1,this.videoWriter=new i({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}F.prototype=Object.create(l.prototype),F.prototype.start=function(e){this.dispose()},F.prototype.add=function(e){this.videoWriter.addFrame(e),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(r){this.filename=this.baseFilename+"-part-"+f(this.part),O(r,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+f(this.part),this.step()}.bind(this)):(this.frames++,this.step())},F.prototype.save=function(e){this.videoWriter.complete().then(e)},F.prototype.dispose=function(e){this.frames=0,this.videoWriter=new i({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})};function _(e){l.call(this,e),e.quality=e.quality/100||.8,this.encoder=new FFMpegServer.Video(e),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(r,B){var b=this.callback;b&&(this.callback=void 0,b(r,B))}.bind(this)),this.encoder.on("progress",function(r){this.settings.onProgress&&this.settings.onProgress(r)}.bind(this)),this.encoder.on("error",function(r){alert(JSON.stringify(r,null,2))}.bind(this))}_.prototype=Object.create(l.prototype),_.prototype.start=function(){this.encoder.start(this.settings)},_.prototype.add=function(e){this.encoder.add(e)},_.prototype.save=function(e){this.callback=e,this.encoder.end()},_.prototype.safeToProceed=function(){return this.encoder.safeToProceed()};function D(e){l.call(this,e),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}D.prototype=Object.create(l.prototype),D.prototype.add=function(e){this.stream||(this.stream=e.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(r){this.chunks.push(r.data)}.bind(this)),this.step()},D.prototype.save=function(e){this.mediaRecorder.onstop=function(r){var B=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],e(B)}.bind(this),this.mediaRecorder.stop()};function P(e){l.call(this,e),e.quality=31-(e.quality*30/100||10),e.workers=e.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new j({workers:e.workers,quality:e.quality,workerScript:e.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(r){this.settings.onProgress&&this.settings.onProgress(r)}.bind(this)),this.encoder.on("finished",function(r){var B=this.callback;B&&(this.callback=void 0,B(r))}.bind(this))}P.prototype=Object.create(l.prototype),P.prototype.add=function(e){this.sizeSet||(this.encoder.setOption("width",e.width),this.encoder.setOption("height",e.height),this.sizeSet=!0),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},P.prototype.save=function(e){this.callback=e,this.encoder.render()};function V(e){var r=e||{},B=new Date,b,Y,x,N,tt,Z,ot,C,H=[],J=[],U=0,o=0,p=null,A=[],T=!1,dt={};r.framerate=r.framerate||60,r.motionBlurFrames=2*(r.motionBlurFrames||1),b=r.verbose||!1,Y=r.display||!1,r.step=1e3/r.framerate,r.timeLimit=r.timeLimit||0,r.frameLimit=r.frameLimit||0,r.startTime=r.startTime||0;var L=document.createElement("div");L.style.position="absolute",L.style.left=L.style.top=0,L.style.backgroundColor="black",L.style.fontFamily="monospace",L.style.fontSize="11px",L.style.padding="5px",L.style.color="red",L.style.zIndex=1e5,r.display&&document.body.appendChild(L);var S=document.createElement("canvas"),et=S.getContext("2d"),M,$;W("Step is set to "+r.step+"ms");var ft={gif:P,webm:F,ffmpegserver:_,png:k,jpg:K,"webm-mediarecorder":D},ut=ft[r.format];if(!ut)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(ft).join(", ");if(C=new ut(r),C.step=ot,C.on("process",mt),C.on("progress",Pt),"performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){var ct=Date.now();performance.timing&&performance.timing.navigationStart&&(ct=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-ct}}var ht=window.setTimeout,vt=window.setInterval,Bt=window.clearInterval,bt=window.clearTimeout,xt=window.requestAnimationFrame,Ct=window.Date.now,Tt=window.performance.now,Et=window.Date.prototype.getTime,lt=[];function Ft(){W("Capturer start"),N=window.Date.now(),x=N+r.startTime,Z=window.performance.now(),tt=Z+r.startTime,window.Date.prototype.getTime=function(){return x},window.Date.now=function(){return x},window.setTimeout=function(a,m){var R={callback:a,time:m,triggerTime:x+m};return H.push(R),W("Timeout set to "+R.time),R},window.clearTimeout=function(a){for(var m=0;m<H.length;m++)if(H[m]==a){H.splice(m,1),W("Timeout cleared");continue}},window.setInterval=function(a,m){var R={callback:a,time:m,triggerTime:x+m};return J.push(R),W("Interval set to "+R.time),R},window.clearInterval=function(a){return W("clear Interval"),null},window.requestAnimationFrame=function(a){A.push(a)},window.performance.now=function(){return tt};function s(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),lt.push(this)),this._hookedTime+r.startTime}try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:s}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:s})}catch(a){W(a)}}function At(){Ft(),C.start(),T=!0}function pt(){T=!1,C.stop(),Mt()}function nt(s,a){ht(s,0,a)}function ot(){nt(mt)}function Mt(){W("Capturer stop"),window.setTimeout=ht,window.setInterval=vt,window.clearInterval=Bt,window.clearTimeout=bt,window.requestAnimationFrame=xt,window.Date.prototype.getTime=Et,window.Date.now=Ct,window.performance.now=Tt}function kt(){var s=U/r.framerate;(r.frameLimit&&U>=r.frameLimit||r.timeLimit&&s>=r.timeLimit)&&(pt(),wt());var a=new Date(null);a.setSeconds(s),r.motionBlurFrames>2?L.textContent="CCapture "+r.format+" | "+U+" frames ("+o+" inter) | "+a.toISOString().substr(11,8):L.textContent="CCapture "+r.format+" | "+U+" frames | "+a.toISOString().substr(11,8)}function _t(s){(S.width!==s.width||S.height!==s.height)&&(S.width=s.width,S.height=s.height,M=new Uint16Array(S.height*S.width*4),et.fillStyle="#0",et.fillRect(0,0,S.width,S.height))}function Ut(s){et.drawImage(s,0,0),$=et.getImageData(0,0,S.width,S.height);for(var a=0;a<M.length;a+=4)M[a]+=$.data[a],M[a+1]+=$.data[a+1],M[a+2]+=$.data[a+2];o++}function Lt(){for(var s=$.data,a=0;a<M.length;a+=4)s[a]=M[a]*2/r.motionBlurFrames,s[a+1]=M[a+1]*2/r.motionBlurFrames,s[a+2]=M[a+2]*2/r.motionBlurFrames;et.putImageData($,0,0),C.add(S),U++,o=0,W("Full MB Frame! "+U+" "+x);for(var a=0;a<M.length;a+=4)M[a]=0,M[a+1]=0,M[a+2]=0;gc()}function St(s){T&&(r.motionBlurFrames>2?(_t(s),Ut(s),o>=.5*r.motionBlurFrames?Lt():ot()):(C.add(s),U++,W("Full Frame! "+U)))}function mt(){var s=1e3/r.framerate,a=(U+o/r.motionBlurFrames)*s;x=N+a,tt=Z+a,lt.forEach(function(R){R._hookedTime=a/1e3}),kt(),W("Frame: "+U+" "+o);for(var m=0;m<H.length;m++)if(x>=H[m].triggerTime){nt(H[m].callback),H.splice(m,1);continue}for(var m=0;m<J.length;m++)if(x>=J[m].triggerTime){nt(J[m].callback),J[m].triggerTime+=J[m].time;continue}A.forEach(function(R){nt(R,x-v)}),A=[]}function wt(s){s||(s=function(a){return O(a,C.filename+C.extension,C.mimeType),!1}),C.save(s)}function W(s){b&&console.log(s)}function It(s,a){dt[s]=a}function Dt(s){var a=dt[s];a&&a.apply(null,Array.prototype.slice.call(arguments,1))}function Pt(s){Dt("progress",s)}return{start:At,capture:St,stop:pt,save:wt,on:It}}(t||c||{}).CCapture=V,typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return V}):E&&z?(X&&((z.exports=V).CCapture=V),E.CCapture=V):n.CCapture=V})()});(function(){var y=!1,d=function(i){this.data=new Uint8Array(i),this.pos=0};d.prototype.seek=function(i){this.pos=i},d.prototype.writeBytes=function(i){for(var u=0;u<i.length;u++)this.data[this.pos++]=i[u]},d.prototype.writeByte=function(i){this.data[this.pos++]=i},d.prototype.writeU8=d.prototype.writeByte,d.prototype.writeU16BE=function(i){this.data[this.pos++]=i>>8,this.data[this.pos++]=i},d.prototype.writeDoubleBE=function(i){for(var u=new Uint8Array(new Float64Array([i]).buffer),g=u.length-1;g>=0;g--)this.writeByte(u[g])},d.prototype.writeFloatBE=function(i){for(var u=new Uint8Array(new Float32Array([i]).buffer),g=u.length-1;g>=0;g--)this.writeByte(u[g])},d.prototype.writeString=function(i){for(var u=0;u<i.length;u++)this.data[this.pos++]=i.charCodeAt(u)},d.prototype.writeEBMLVarIntWidth=function(i,u){switch(u){case 1:this.writeU8(1<<7|i);break;case 2:this.writeU8(1<<6|i>>8),this.writeU8(i);break;case 3:this.writeU8(1<<5|i>>16),this.writeU8(i>>8),this.writeU8(i);break;case 4:this.writeU8(1<<4|i>>24),this.writeU8(i>>16),this.writeU8(i>>8),this.writeU8(i);break;case 5:this.writeU8(1<<3|i/4294967296&7),this.writeU8(i>>24),this.writeU8(i>>16),this.writeU8(i>>8),this.writeU8(i);break;default:throw new RuntimeException("Bad EBML VINT size "+u)}},d.prototype.measureEBMLVarInt=function(i){if(i<(1<<7)-1)return 1;if(i<(1<<14)-1)return 2;if(i<(1<<21)-1)return 3;if(i<(1<<28)-1)return 4;if(i<34359738367)return 5;throw new RuntimeException("EBML VINT size not supported "+i)},d.prototype.writeEBMLVarInt=function(i){this.writeEBMLVarIntWidth(i,this.measureEBMLVarInt(i))},d.prototype.writeUnsignedIntBE=function(i,u){switch(u===void 0&&(u=this.measureUnsignedInt(i)),u){case 5:this.writeU8(Math.floor(i/4294967296));case 4:this.writeU8(i>>24);case 3:this.writeU8(i>>16);case 2:this.writeU8(i>>8);case 1:this.writeU8(i);break;default:throw new RuntimeException("Bad UINT size "+u)}},d.prototype.measureUnsignedInt=function(i){return i<1<<8?1:i<1<<16?2:i<1<<24?3:i<4294967296?4:5},d.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayBufferDataStream's pos lies beyond end of buffer"},window.ArrayBufferDataStream=d;var O=function(i){return function(u){var g=[],q=Promise.resolve(),G=null,E=null;typeof FileWriter!="undefined"&&u instanceof FileWriter?G=u:i&&u&&(E=u),this.pos=0,this.length=0;function z(c){return new Promise(function(t,h){var n=new FileReader;n.addEventListener("loadend",function(){t(n.result)}),n.readAsArrayBuffer(c)})}function X(c){return new Promise(function(t,h){c instanceof Uint8Array?t(c):c instanceof ArrayBuffer||ArrayBuffer.isView(c)?t(new Uint8Array(c)):c instanceof Blob?t(z(c).then(function(n){return new Uint8Array(n)})):t(z(new Blob([c])).then(function(n){return new Uint8Array(n)}))})}function Q(c){var t=c.byteLength||c.length||c.size;if(!Number.isInteger(t))throw"Failed to determine size of element";return t}this.seek=function(c){if(c<0)throw"Offset may not be negative";if(isNaN(c))throw"Offset may not be NaN";if(c>this.length)throw"Seeking beyond the end of file is not allowed";this.pos=c},this.write=function(c){var t={offset:this.pos,data:c,length:Q(c)},h=t.offset>=this.length;this.pos+=t.length,this.length=Math.max(this.length,this.pos),q=q.then(function(){if(E)return new Promise(function(v,I){X(t.data).then(function(l){var w=0,k=Buffer.from(l.buffer),K=function(F,_,D){w+=_,w>=D.length?v():i.write(E,D,w,D.length-w,t.offset+w,K)};i.write(E,k,0,k.length,t.offset,K)})});if(G)return new Promise(function(v,I){G.onwriteend=v,G.seek(t.offset),G.write(new Blob([t.data]))});if(!h)for(var n=0;n<g.length;n++){var f=g[n];if(!(t.offset+t.length<=f.offset||t.offset>=f.offset+f.length)){if(t.offset<f.offset||t.offset+t.length>f.offset+f.length)throw new Error("Overwrite crosses blob boundaries");if(t.offset==f.offset&&t.length==f.length){f.data=t.data;return}else return X(f.data).then(function(v){return f.data=v,X(t.data)}).then(function(v){t.data=v,f.data.set(t.data,t.offset-f.offset)})}}g.push(t)})},this.complete=function(c){return E||G?q=q.then(function(){return null}):q=q.then(function(){for(var t=[],h=0;h<g.length;h++)t.push(g[h].data);return new Blob(t,{mimeType:c})}),q}}}(null);window.BlobBuffer=O;var j=function(i,u){function g(t,h){var n={};return[t,h].forEach(function(f){for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(n[v]=f[v])}),n}function q(t){return typeof t!="string"||!t.match(/^data:image\/webp;base64,/i)?!1:window.atob(t.substring("data:image/webp;base64,".length))}function G(t){for(var h=new ArrayBuffer(t.length),n=new Uint8Array(h),f=0;f<t.length;f++)n[f]=t.charCodeAt(f);return h}function E(t,h){var n=t.toDataURL("image/webp",{quality:h});return q(n)}function z(t){var h=t.indexOf("VP8 ");if(h==-1)throw"Failed to identify beginning of keyframe in WebP image";return h+="VP8 ".length+4,t.substring(h)}function X(t){this.value=t}function Q(t){this.value=t}function c(t,h,n){if(Array.isArray(n))for(var f=0;f<n.length;f++)c(t,h,n[f]);else if(typeof n=="string")t.writeString(n);else if(n instanceof Uint8Array)t.writeBytes(n);else if(n.id)if(n.offset=t.pos+h,t.writeUnsignedIntBE(n.id),Array.isArray(n.data)){var v,I,l;n.size===-1?t.writeByte(255):(v=t.pos,t.writeBytes([0,0,0,0])),I=t.pos,n.dataOffset=I+h,c(t,h,n.data),n.size!==-1&&(l=t.pos,n.size=l-I,t.seek(v),t.writeEBMLVarIntWidth(n.size,4),t.seek(l))}else if(typeof n.data=="string")t.writeEBMLVarInt(n.data.length),n.dataOffset=t.pos+h,t.writeString(n.data);else if(typeof n.data=="number")n.size||(n.size=t.measureUnsignedInt(n.data)),t.writeEBMLVarInt(n.size),n.dataOffset=t.pos+h,t.writeUnsignedIntBE(n.data,n.size);else if(n.data instanceof Q)t.writeEBMLVarInt(8),n.dataOffset=t.pos+h,t.writeDoubleBE(n.data.value);else if(n.data instanceof X)t.writeEBMLVarInt(4),n.dataOffset=t.pos+h,t.writeFloatBE(n.data.value);else if(n.data instanceof Uint8Array)t.writeEBMLVarInt(n.data.byteLength),n.dataOffset=t.pos+h,t.writeBytes(n.data);else throw"Bad EBML datatype "+typeof n.data;else throw"Bad EBML datatype "+typeof n.data}return function(t){var h=5e3,n=1,f=!1,v,I,l=[],w=0,k=0,K={quality:.95,fileWriter:null,fd:null,frameDuration:null,frameRate:null},F={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},_,D={id:17545,data:new Q(0)},P,V=[],e=new u(t.fileWriter||t.fd);function r(o){return o-_.dataOffset}function B(){var o={id:21420,size:5,data:0},p={id:290298740,data:[]};for(var A in F){var T=F[A];T.positionEBML=Object.create(o),p.data.push({id:19899,data:[{id:21419,data:T.id},T.positionEBML]})}return p}function b(){P=B();var o={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},p={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},D]},A={id:374648427,data:[{id:174,data:[{id:215,data:n},{id:29637,data:n},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:[{id:176,data:v},{id:186,data:I}]}]}]};_={id:408125543,size:-1,data:[P,p,A]};var T=new i(256);c(T,e.pos,[o,_]),e.write(T.getAsDataArray()),F.SegmentInfo.positionEBML.data=r(p.offset),F.Tracks.positionEBML.data=r(A.offset)}function Y(o){var p=new i(1+2+1);if(!(o.trackNumber>0&&o.trackNumber<127))throw"TrackNumber must be > 0 and < 127";return p.writeEBMLVarInt(o.trackNumber),p.writeU16BE(o.timecode),p.writeByte(1<<7),{id:163,data:[p.getAsDataArray(),o.frame]}}function x(o){return{id:524531317,data:[{id:231,data:Math.round(o.timecode)}]}}function N(o,p,A){V.push({id:187,data:[{id:179,data:p},{id:183,data:[{id:247,data:o},{id:241,data:r(A)}]}]})}function tt(){var o={id:475249515,data:V},p=new i(16+V.length*32);c(p,e.pos,o),e.write(p.getAsDataArray()),F.Cues.positionEBML.data=r(o.offset)}function Z(){if(l.length!=0){for(var o=0,p=0;p<l.length;p++)o+=l[p].frame.length;for(var A=new i(o+l.length*32),T=x({timecode:Math.round(w)}),p=0;p<l.length;p++)T.data.push(Y(l[p]));c(A,e.pos,T),e.write(A.getAsDataArray()),N(n,Math.round(w),T.offset),l=[],w+=k,k=0}}function C(){if(!t.frameDuration)if(t.frameRate)t.frameDuration=1e3/t.frameRate;else throw"Missing required frameDuration or frameRate setting"}function H(o){o.trackNumber=n,o.timecode=Math.round(k),l.push(o),k+=o.duration,k>=h&&Z()}function J(){var o=new i(P.size),p=e.pos;c(o,P.dataOffset,P.data),e.seek(P.dataOffset),e.write(o.getAsDataArray()),e.seek(p)}function U(){var o=new i(8),p=e.pos;o.writeDoubleBE(w),e.seek(D.dataOffset),e.write(o.getAsDataArray()),e.seek(p)}this.addFrame=function(o){if(f){if(o.width!=v||o.height!=I)throw"Frame size differs from previous frames"}else v=o.width,I=o.height,b(),f=!0;var p=E(o,{quality:t.quality});if(!p)throw"Couldn't decode WebP frame, does the browser support WebP?";H({frame:z(p),duration:t.frameDuration})},this.complete=function(){return Z(),tt(),J(),U(),e.complete("video/webm")},this.getWrittenSize=function(){return e.length},t=g(K,t||{}),C()}};window.WebMWriter=j(d,O)})();var gt=jt(yt()),at=class{constructor(){this.active=!1,this.running=!1}enableCapture({frameCount:d,element:O,onComplete:j}){this.active=!0,this.el=O,this.maxFrames=d,this.frames=0,this.capture=new gt.default({framerate:60,format:"webm",verbose:!1}),this.onComplete=j||function(){}}captureFrame(){this.active&&!this.running&&this.capture.start(),this.active&&(this.capture.capture(this.el),this.frames++,this.frames>this.maxFrames&&(this.capture.stop(),this.capture.save(),this.onComplete()))}};if(window){let y=new at;window.enableCapture=y.enableCapture,window.captureFrame=y.captureFrame}})();
// @license http://opensource.org/licenses/MIT
//# sourceMappingURL=p5.webm-capture.js.map
