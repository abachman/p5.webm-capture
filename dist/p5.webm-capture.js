(()=>{var N=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ct=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var J,dt=N(()=>{J=function(e,t,r){var a=window,l="application/octet-stream",m=r||l,c=e,u=!t&&!r&&c,w=document.createElement("a"),d=function(p){return String(p)},i=a.Blob||a.MozBlob||a.WebKitBlob||d,x=t||"download",g,C;if(i=i.call?i.bind(a):Blob,String(this)==="true"&&(c=[c,m],m=c[0],c=c[1]),u&&u.length<2048&&(x=u.split("/").pop().split("?")[0],w.href=u,w.href.indexOf(u)!==-1)){var A=new XMLHttpRequest;return A.open("GET",u,!0),A.responseType="blob",A.onload=function(p){J(p.target.response,x,l)},setTimeout(function(){A.send()},0),A}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c))if(c.length>1024*1024*1.999&&i!==d)c=T(c),m=c.type||l;else return navigator.msSaveBlob?navigator.msSaveBlob(T(c),x):b(c);else if(/([\x80-\xff])/.test(c)){var y=0,E=new Uint8Array(c.length),k=E.length;for(y;y<k;++y)E[y]=c.charCodeAt(y);c=new i([E],{type:m})}g=c instanceof i?c:new i([c],{type:m});function T(p){var S=p.split(/[:;,]/),_=S[1],F=p.indexOf("charset")>0?3:2,G=S[F]=="base64"?atob:decodeURIComponent,W=G(S.pop()),O=W.length,I=0,z=new Uint8Array(O);for(I;I<O;++I)z[I]=W.charCodeAt(I);return new i([z],{type:_})}function b(p,S){if("download"in w)return w.href=p,w.setAttribute("download",x),w.className="download-js-link",w.innerHTML="downloading...",w.style.display="none",w.addEventListener("click",function(F){F.stopPropagation(),this.removeEventListener("click",arguments.callee)}),document.body.appendChild(w),setTimeout(function(){w.click(),document.body.removeChild(w),S===!0&&setTimeout(function(){a.URL.revokeObjectURL(w.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,l)),window.open(p)||confirm("Displaying New Document. Use Save As... to download, then click back to return to this page.")&&(location.href=p),!0;var _=document.createElement("iframe");document.body.appendChild(_),!S&&/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,l)),_.src=p,setTimeout(function(){document.body.removeChild(_)},333)}return b(a.URL.createObjectURL(g),!0),!0}});var D,lt=N(()=>{D=class{constructor(t){this.data=new Uint8Array(t),this.pos=0}seek(t){this.pos=t}writeBytes(t){for(let r=0;r<t.length;r++)this.data[this.pos++]=t[r]}writeByte(t){this.data[this.pos++]=t}writeU16BE(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t}writeDoubleBE(t){let r=new Uint8Array(new Float64Array([t]).buffer);for(let a=r.length-1;a>=0;a--)this.writeByte(r[a])}writeFloatBE(t){let r=new Uint8Array(new Float32Array([t]).buffer);for(let a=r.length-1;a>=0;a--)this.writeByte(r[a])}writeString(t){for(let r=0;r<t.length;r++)this.data[this.pos++]=t.charCodeAt(r)}writeEBMLVarIntWidth(t,r){switch(r){case 1:this.writeU8(1<<7|t);break;case 2:this.writeU8(1<<6|t>>8),this.writeU8(t);break;case 3:this.writeU8(1<<5|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(1<<4|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(1<<3|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new Error("Bad EBML VINT size "+r)}}measureEBMLVarInt(t){if(t<(1<<7)-1)return 1;if(t<(1<<14)-1)return 2;if(t<(1<<21)-1)return 3;if(t<(1<<28)-1)return 4;if(t<34359738367)return 5;throw new Error("EBML VINT size not supported "+t)}writeEBMLVarInt(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))}writeUnsignedIntBE(t,r){switch(r===void 0&&(r=this.measureUnsignedInt(t)),r){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new Error("Bad UINT size "+r)}}measureUnsignedInt(t){return t<1<<8?1:t<1<<16?2:t<1<<24?3:t<4294967296?4:5}getAsDataArray(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw new Error("ArrayBufferDataStream's pos lies beyond end of buffer")}};D.prototype.writeU8=D.prototype.writeByte});var it,at,ft=N(()=>{it=null,at=class{constructor(t){let r=[],a=Promise.resolve(),l=null,m=null;t&&t.constructor.name==="FileWriter"?l=t:it&&t&&(m=t),this.pos=0,this.length=0;function c(d){return new Promise(function(i,x){let g=new FileReader;g.addEventListener("loadend",function(){i(g.result)}),g.readAsArrayBuffer(d)})}function u(d){return new Promise(function(i,x){d instanceof Uint8Array?i(d):d instanceof ArrayBuffer||ArrayBuffer.isView(d)?i(new Uint8Array(d)):d instanceof Blob?i(c(d).then(function(g){return new Uint8Array(g)})):i(c(new Blob([d])).then(function(g){return new Uint8Array(g)}))})}function w(d){let i=d.byteLength||d.length||d.size;if(!Number.isInteger(i))throw new Error("Failed to determine size of element");return i}this.seek=function(d){if(d<0)throw new Error("Offset may not be negative");if(isNaN(d))throw new Error("Offset may not be NaN");if(d>this.length)throw new Error("Seeking beyond the end of file is not allowed");this.pos=d},this.write=function(d){let i={offset:this.pos,data:d,length:w(d)},x=i.offset>=this.length;this.pos+=i.length,this.length=Math.max(this.length,this.pos),a=a.then(function(){if(m)return new Promise(function(g,C){u(i.data).then(function(A){let y=0,E=Buffer.from(A.buffer),k=function(T,b,p){y+=b,y>=p.length?g():it.write(m,p,y,p.length-y,i.offset+y,k)};it.write(m,E,0,E.length,i.offset,k)})});if(l)return new Promise(function(g,C){l.onwriteend=g,l.seek(i.offset),l.write(new Blob([i.data]))});if(!x)for(let g=0;g<r.length;g++){let C=r[g];if(!(i.offset+i.length<=C.offset||i.offset>=C.offset+C.length)){if(i.offset<C.offset||i.offset+i.length>C.offset+C.length)throw new Error("Overwrite crosses blob boundaries");if(i.offset==C.offset&&i.length==C.length){C.data=i.data;return}else return u(C.data).then(function(A){return C.data=A,u(i.data)}).then(function(A){i.data=A,C.data.set(i.data,i.offset-C.offset)})}}r.push(i)})},this.complete=function(d){return m||l?a=a.then(function(){return null}):a=a.then(function(){let i=[];for(let x=0;x<r.length;x++)i.push(r[x].data);return new Blob(i,{type:d})}),a}}}});function Et(e,t){let r={};return[e,t].forEach(function(a){for(let l in a)Object.prototype.hasOwnProperty.call(a,l)&&(r[l]=a[l])}),r}function Tt(e){if(typeof e!="string"||!e.match(/^data:image\/webp;base64,/i))throw new Error("Failed to decode WebP Base64 URL");return window.atob(e.substring("data:image/webp;base64,".length))}function ut(e,t){let r=typeof e=="string"&&/^data:image\/webp/.test(e)?e:e.toDataURL("image/webp",t);return Tt(r)}function At(e){let t=e.charCodeAt(0),r=e.charCodeAt(1),a=e.charCodeAt(2),l=e.charCodeAt(3);return(t|r<<8|a<<16|l<<24)>>>0}function ct(e){let t=e.indexOf("VP8",12);if(t===-1)throw new Error("Bad image format, does this browser support WebP?");let r=!1;for(;t<e.length-8;){let a,l;switch(l=e.substring(t,t+4),t+=4,a=At(e.substring(t,t+4)),t+=4,l){case"VP8 ":return{frame:e.substring(t,t+a),hasAlpha:r};case"ALPH":r=!0;break}t+=a,(a&1)!==0&&t++}throw new Error("Failed to find VP8 keyframe in WebP image, is this image mistakenly encoded in the Lossless WebP format?")}function vt(e){this.value=e}function ht(e){this.value=e}function j(e,t,r){if(Array.isArray(r))for(let a=0;a<r.length;a++)j(e,t,r[a]);else if(typeof r=="string")e.writeString(r);else if(r instanceof Uint8Array)e.writeBytes(r);else if(r.id)if(r.offset=e.pos+t,e.writeUnsignedIntBE(r.id),Array.isArray(r.data)){let a,l,m;r.size===-1?e.writeByte(255):(a=e.pos,e.writeBytes([0,0,0,0])),l=e.pos,r.dataOffset=l+t,j(e,t,r.data),r.size!==-1&&(m=e.pos,r.size=m-l,e.seek(a),e.writeEBMLVarIntWidth(r.size,4),e.seek(m))}else if(typeof r.data=="string")e.writeEBMLVarInt(r.data.length),r.dataOffset=e.pos+t,e.writeString(r.data);else if(typeof r.data=="number")r.size||(r.size=e.measureUnsignedInt(r.data)),e.writeEBMLVarInt(r.size),r.dataOffset=e.pos+t,e.writeUnsignedIntBE(r.data,r.size);else if(r.data instanceof ht)e.writeEBMLVarInt(8),r.dataOffset=e.pos+t,e.writeDoubleBE(r.data.value);else if(r.data instanceof vt)e.writeEBMLVarInt(4),r.dataOffset=e.pos+t,e.writeFloatBE(r.data.value);else if(r.data instanceof Uint8Array)e.writeEBMLVarInt(r.data.byteLength),r.dataOffset=e.pos+t,e.writeBytes(r.data);else throw new Error("Bad EBML datatype "+typeof r.data);else throw new Error("Bad EBML datatype "+typeof r.data)}var Y,pt=N(()=>{lt();ft();Y=class{constructor(t){let r=5e3,a=1,l=!1,m=0,c=0,u=null,w=null,d=null,i=[],x=0,g=0,C={quality:.95,transparent:!1,alphaQuality:void 0,fileWriter:null,fd:null,frameDuration:null,frameRate:null},A={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},y,E={id:17545,data:new ht(0)},k,T=[],b=new at(t.fileWriter||t.fd);function p(n){return n-y.dataOffset}function S(n){(u===null||u.width!==n.width||u.height!==n.height)&&(u=document.createElement("canvas"),u.width=n.width,u.height=n.height,w=u.getContext("2d"),d=w.createImageData(u.width,u.height));let f=n.getContext("2d"),v=f.getImageData(0,0,n.width,n.height).data,h=d.data,L=0,R=n.width*n.height*4;for(let Q=3;Q<R;Q+=4){let q=v[Q];h[L++]=q,h[L++]=q,h[L++]=q,h[L++]=255}return w.putImageData(d,0,0),u}function _(){let n={id:21420,size:5,data:0},f={id:290298740,data:[]};for(let v in A){let h=A[v];h.positionEBML=Object.create(n),f.data.push({id:19899,data:[{id:21419,data:h.id},h.positionEBML]})}return f}function F(){k=_();let n={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},f={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},E]},v=[{id:176,data:m},{id:186,data:c}];t.transparent&&v.push({id:21440,data:1});let h={id:374648427,data:[{id:174,data:[{id:215,data:a},{id:29637,data:a},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:v}]}]};y={id:408125543,size:-1,data:[k,f,h]};let L=new D(256);j(L,b.pos,[n,y]),b.write(L.getAsDataArray()),A.SegmentInfo.positionEBML.data=p(f.offset),A.Tracks.positionEBML.data=p(h.offset),l=!0}function G(n){let f,v,h=new D(1+2+1);if(!(n.trackNumber>0&&n.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return h.writeEBMLVarInt(n.trackNumber),h.writeU16BE(n.timecode),h.writeByte(0),f={id:161,data:[h.getAsDataArray(),n.frame]},v={id:30113,data:[{id:166,data:[{id:238,data:1},{id:165,data:n.alpha}]}]},{id:160,data:[f,v]}}function W(n){let f=new D(1+2+1);if(!(n.trackNumber>0&&n.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return f.writeEBMLVarInt(n.trackNumber),f.writeU16BE(n.timecode),f.writeByte(1<<7),{id:163,data:[f.getAsDataArray(),n.frame]}}function O(n){return n.alpha?G(n):W(n)}function I(n){return{id:524531317,data:[{id:231,data:Math.round(n.timecode)}]}}function z(n,f,v){T.push({id:187,data:[{id:179,data:f},{id:183,data:[{id:247,data:n},{id:241,data:p(v)}]}]})}function tt(){let n={id:475249515,data:T},f=new D(16+T.length*32);j(f,b.pos,n),b.write(f.getAsDataArray()),A.Cues.positionEBML.data=p(n.offset)}function K(){if(i.length===0)return;let n=0;for(let h=0;h<i.length;h++)n+=i[h].frame.length+(i[h].alpha?i[h].alpha.length:0);let f=new D(n+i.length*64),v=I({timecode:Math.round(x)});for(let h=0;h<i.length;h++)v.data.push(O(i[h]));j(f,b.pos,v),b.write(f.getAsDataArray()),z(a,Math.round(x),v.offset),i=[],x+=g,g=0}function et(){if(!t.frameDuration)if(t.frameRate)t.frameDuration=1e3/t.frameRate;else throw new Error("Missing required frameDuration or frameRate setting");t.quality=Math.max(Math.min(t.quality,.99999),0),t.alphaQuality===void 0?t.alphaQuality=t.quality:t.alphaQuality=Math.max(Math.min(t.alphaQuality,.99999),0)}function rt(n){n.trackNumber=a,n.timecode=Math.round(g),i.push(n),g+=n.duration,g>=r&&K()}function X(){let n=new D(k.size),f=b.pos;j(n,k.dataOffset,k.data),b.seek(k.dataOffset),b.write(n.getAsDataArray()),b.seek(f)}function V(){let n=new D(8),f=b.pos;n.writeDoubleBE(x),b.seek(E.dataOffset),b.write(n.getAsDataArray()),b.seek(f)}this.addFrame=function(n,f,v){l||(m=n.width||0,c=n.height||0,F());let h=ct(ut(n,t.quality)),L,R=null;v?L=v:typeof f=="number"?L=f:L=t.frameDuration,t.transparent&&(f instanceof HTMLCanvasElement||typeof f=="string"?R=f:h.hasAlpha&&(R=S(n))),rt({frame:h.frame,duration:L,alpha:R?ct(ut(R,t.alphaQuality)).frame:null})},this.complete=function(){return l||F(),K(),tt(),X(),V(),b.complete("video/webm")},this.getWrittenSize=function(){return b.length},t=Et(C,t||{}),et()}}});function mt(e){return String("0000000"+e).slice(-7)}function Lt(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function M(e){let t={};this.settings=e,this.on=function(r,a){t[r]=a},this.emit=function(r){let a=t[r];a&&a.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=e.name||Lt(),this.extension="",this.mimeType=""}function H(e){M.call(this,e),this.quality=e.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=e.framerate,this.frames=0,this.part=1,this.videoWriter=new Y({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}function Z(e){M.call(this,e),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function nt(e){M.call(this,e),e.quality=31-(e.quality*30/100||10),e.workers=e.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:e.workers,quality:e.quality,workerScript:e.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){let r=this.callback;r&&(this.callback=void 0,r(t))}.bind(this))}function wt(e){let t=e||{},r,a,l,m,c,u,w=[],d=[],i=0,x=0,g=[],C=!1,A={};t.framerate=t.framerate||60,t.motionBlurFrames=2*(t.motionBlurFrames||1),r=t.verbose||!1,t.step=1e3/t.framerate,t.timeLimit=t.timeLimit||0,t.frameLimit=t.frameLimit||0,t.startTime=t.startTime||0;let y=document.createElement("div");y.style.position="absolute",y.style.left=y.style.top=0,y.style.backgroundColor="black",y.style.fontFamily="monospace",y.style.fontSize="11px",y.style.padding="5px",y.style.color="red",y.style.zIndex=1e5,t.display&&document.body.appendChild(y);let E=document.createElement("canvas"),k=E.getContext("2d"),T,b;U("Step is set to "+t.step+"ms");let p={webm:H,"webm-mediarecorder":Z},S=p[t.format];if(!S)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(p).join(", ");if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){let s=Date.now();performance.timing&&performance.timing.navigationStart&&(s=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-s}}let _=window.setTimeout,F=window.setInterval,G=window.clearInterval,W=window.clearTimeout,O=window.requestAnimationFrame,I=window.Date.now,z=window.performance.now,tt=window.Date.prototype.getTime,K=[];function et(){U("Capturer start"),l=window.Date.now(),a=l+t.startTime,c=window.performance.now(),m=c+t.startTime,window.Date.prototype.getTime=function(){return a},window.Date.now=function(){return a},window.setTimeout=function(o,B){let P={callback:o,time:B,triggerTime:a+B};return w.push(P),U("Timeout set to "+P.time),P},window.clearTimeout=function(o){for(let B=0;B<w.length;B++)if(w[B]==o){w.splice(B,1),U("Timeout cleared");continue}},window.setInterval=function(o,B){let P={callback:o,time:B,triggerTime:a+B};return d.push(P),U("Interval set to "+P.time),P},window.clearInterval=function(o){return U("clear Interval"),null},window.requestAnimationFrame=function(o){g.push(o)},window.performance.now=function(){return m};function s(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),K.push(this)),this._hookedTime+t.startTime}try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:s}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:s})}catch(o){U(o)}}function rt(){et(),u.start(),C=!0}function X(){C=!1,u.stop(),f()}function V(s,o){_(s,0,o)}function n(){V(q)}u=new S(t),u.step=n,u.on("process",q),u.on("progress",xt);function f(){U("Capturer stop"),window.setTimeout=_,window.setInterval=F,window.clearInterval=G,window.clearTimeout=W,window.requestAnimationFrame=O,window.Date.prototype.getTime=tt,window.Date.now=I,window.performance.now=z}function v(){let s=i/t.framerate;(t.frameLimit&&i>=t.frameLimit||t.timeLimit&&s>=t.timeLimit)&&(X(),st());let o=new Date(null);o.setSeconds(s),t.motionBlurFrames>2?y.textContent="CCapture "+t.format+" | "+i+" frames ("+x+" inter) | "+o.toISOString().substr(11,8):y.textContent="CCapture "+t.format+" | "+i+" frames | "+o.toISOString().substr(11,8)}function h(s){(E.width!==s.width||E.height!==s.height)&&(E.width=s.width,E.height=s.height,T=new Uint16Array(E.height*E.width*4),k.fillStyle="#0",k.fillRect(0,0,E.width,E.height))}function L(s){k.drawImage(s,0,0),b=k.getImageData(0,0,E.width,E.height);for(let o=0;o<T.length;o+=4)T[o]+=b.data[o],T[o+1]+=b.data[o+1],T[o+2]+=b.data[o+2];x++}function R(){let s=b.data;for(let o=0;o<T.length;o+=4)s[o]=T[o]*2/t.motionBlurFrames,s[o+1]=T[o+1]*2/t.motionBlurFrames,s[o+2]=T[o+2]*2/t.motionBlurFrames;k.putImageData(b,0,0),u.add(E),i++,x=0,U("Full MB Frame! "+i+" "+a);for(let o=0;o<T.length;o+=4)T[o]=0,T[o+1]=0,T[o+2]=0;gc()}function Q(s){C&&(t.motionBlurFrames>2?(h(s),L(s),x>=.5*t.motionBlurFrames?R():n()):(u.add(s),i++,U("Full Frame! "+i)))}function q(){let s=1e3/t.framerate,o=(i+x/t.motionBlurFrames)*s;a=l+o,m=c+o,K.forEach(function(B){B._hookedTime=o/1e3}),v(),U("Frame: "+i+" "+x);for(let B=0;B<w.length;B++)if(a>=w[B].triggerTime){V(w[B].callback),w.splice(B,1);continue}for(let B=0;B<d.length;B++)if(a>=d[B].triggerTime){V(d[B].callback),d[B].triggerTime+=d[B].time;continue}g.forEach(function(B){V(B,a-kt)}),g=[]}function st(s){s||(s=function(o){return J(o,u.filename+u.extension,u.mimeType),!1}),u.save(s)}function U(s){r&&console.log(s)}function bt(s,o){A[s]=o}function Bt(s){let o=A[s];o&&o.apply(null,Array.prototype.slice.call(arguments,1))}function xt(s){Bt("progress",s)}return{start:rt,capture:Q,stop:X,save:st,on:bt}}var kt,gt=N(()=>{dt();pt();kt=window.Date.now();M.prototype.start=function(){};M.prototype.stop=function(){};M.prototype.add=function(){};M.prototype.save=function(){};M.prototype.dispose=function(){};M.prototype.safeToProceed=function(){return!0};M.prototype.step=function(){console.log("Step not set!")};H.prototype=Object.create(M.prototype);H.prototype.start=function(e){this.dispose()};H.prototype.add=function(e){this.videoWriter.addFrame(e),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+mt(this.part),J(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+mt(this.part),this.step()}.bind(this)):(this.frames++,this.step())};H.prototype.save=function(e){this.videoWriter.complete().then(e)};H.prototype.dispose=function(e){this.frames=0,this.videoWriter=new Y({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})};Z.prototype=Object.create(M.prototype);Z.prototype.add=function(e){this.stream||(this.stream=e.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()};Z.prototype.save=function(e){this.mediaRecorder.onstop=function(t){let r=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],e(r)}.bind(this),this.mediaRecorder.stop()};nt.prototype=Object.create(M.prototype);nt.prototype.add=function(e){this.sizeSet||(this.encoder.setOption("width",e.width),this.encoder.setOption("height",e.height),this.sizeSet=!0),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()};nt.prototype.save=function(e){this.callback=e,this.encoder.render()}});var $,yt=N(()=>{gt();$=class{constructor(){this.active=!1,this.running=!1,this.manualStop=!1}enableCapture(t={}){this.active=!0,this.el=t.element||document.querySelector("canvas"),this.maxFrames=t.frameCount||600,this.manualStop=t.frameCount<1,this.capture=wt({framerate:t.frameRate||60,format:"webm",verbose:!1,display:!!t.display}),this.onComplete=t.onComplete||function(){}}startCapture(){this.active&&!this.running&&(console.log("[webm-capture] started"),this.capture.start(),this.frames=0,this.running=!0)}captureFrame(){this.active&&(this.capture.capture(this.el),this.frames++,!this.manualStop&&this.frames>=this.maxFrames&&this.stopCapture())}stopCapture(){console.log("[webm-capture] finished"),this.capture.stop(),this.capture.save(),this.active=!1,this.onComplete()}}});var Mt=Ct(ot=>{yt();if(window){let e=new $,t=e.enableCapture.bind(e),r=e.startCapture.bind(e),a=e.captureFrame.bind(e),l=e.stopCapture.bind(e);if(window.p5){let m=window.p5;m.prototype.enableCapture=t,m.prototype.stopCapture=l,m.prototype.registerMethod("init",()=>{ot.enableCapture=t,ot.stopCapture=l}),m.prototype.registerMethod("pre",()=>{r()}),m.prototype.registerMethod("post",()=>{try{a()}catch(c){console.error(c)}})}else console.error(["[webm-capture] ERROR! Could not find p5 object. Make sure the p5.js <script> tag is included in the page before p5.webm-capture."])}});Mt();})();
//# sourceMappingURL=p5.webm-capture.js.map
