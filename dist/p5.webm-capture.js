(()=>{var N=(e,t)=>()=>(e&&(t=e(e=0)),t);var Ct=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var J,st=N(()=>{J=function(e,t,r){var a=window,d="application/octet-stream",B=r||d,h=e,u=!t&&!r&&h,m=document.createElement("a"),l=function(p){return String(p)},i=a.Blob||a.MozBlob||a.WebKitBlob||l,x=t||"download",w,C;if(i=i.call?i.bind(a):Blob,String(this)==="true"&&(h=[h,B],B=h[0],h=h[1]),u&&u.length<2048&&(x=u.split("/").pop().split("?")[0],m.href=u,m.href.indexOf(u)!==-1)){var A=new XMLHttpRequest;return A.open("GET",u,!0),A.responseType="blob",A.onload=function(p){J(p.target.response,x,d)},setTimeout(function(){A.send()},0),A}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(h))if(h.length>1024*1024*1.999&&i!==l)h=T(h),B=h.type||d;else return navigator.msSaveBlob?navigator.msSaveBlob(T(h),x):y(h);else if(/([\x80-\xff])/.test(h)){var g=0,E=new Uint8Array(h.length),k=E.length;for(g;g<k;++g)E[g]=h.charCodeAt(g);h=new i([E],{type:B})}w=h instanceof i?h:new i([h],{type:B});function T(p){var U=p.split(/[:;,]/),_=U[1],F=p.indexOf("charset")>0?3:2,G=U[F]=="base64"?atob:decodeURIComponent,W=G(U.pop()),O=W.length,I=0,z=new Uint8Array(O);for(I;I<O;++I)z[I]=W.charCodeAt(I);return new i([z],{type:_})}function y(p,U){if("download"in m)return m.href=p,m.setAttribute("download",x),m.className="download-js-link",m.innerHTML="downloading...",m.style.display="none",m.addEventListener("click",function(F){F.stopPropagation(),this.removeEventListener("click",arguments.callee)}),document.body.appendChild(m),setTimeout(function(){m.click(),document.body.removeChild(m),U===!0&&setTimeout(function(){a.URL.revokeObjectURL(m.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,d)),window.open(p)||confirm("Displaying New Document. Use Save As... to download, then click back to return to this page.")&&(location.href=p),!0;var _=document.createElement("iframe");document.body.appendChild(_),!U&&/^data:/.test(p)&&(p="data:"+p.replace(/^data:([\w\/\-\+]+)/,d)),_.src=p,setTimeout(function(){document.body.removeChild(_)},333)}return y(a.URL.createObjectURL(w),!0),!0}});var D,dt=N(()=>{D=class{constructor(t){this.data=new Uint8Array(t),this.pos=0}seek(t){this.pos=t}writeBytes(t){for(let r=0;r<t.length;r++)this.data[this.pos++]=t[r]}writeByte(t){this.data[this.pos++]=t}writeU16BE(t){this.data[this.pos++]=t>>8,this.data[this.pos++]=t}writeDoubleBE(t){let r=new Uint8Array(new Float64Array([t]).buffer);for(let a=r.length-1;a>=0;a--)this.writeByte(r[a])}writeFloatBE(t){let r=new Uint8Array(new Float32Array([t]).buffer);for(let a=r.length-1;a>=0;a--)this.writeByte(r[a])}writeString(t){for(let r=0;r<t.length;r++)this.data[this.pos++]=t.charCodeAt(r)}writeEBMLVarIntWidth(t,r){switch(r){case 1:this.writeU8(1<<7|t);break;case 2:this.writeU8(1<<6|t>>8),this.writeU8(t);break;case 3:this.writeU8(1<<5|t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 4:this.writeU8(1<<4|t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;case 5:this.writeU8(1<<3|t/4294967296&7),this.writeU8(t>>24),this.writeU8(t>>16),this.writeU8(t>>8),this.writeU8(t);break;default:throw new Error("Bad EBML VINT size "+r)}}measureEBMLVarInt(t){if(t<(1<<7)-1)return 1;if(t<(1<<14)-1)return 2;if(t<(1<<21)-1)return 3;if(t<(1<<28)-1)return 4;if(t<34359738367)return 5;throw new Error("EBML VINT size not supported "+t)}writeEBMLVarInt(t){this.writeEBMLVarIntWidth(t,this.measureEBMLVarInt(t))}writeUnsignedIntBE(t,r){switch(r===void 0&&(r=this.measureUnsignedInt(t)),r){case 5:this.writeU8(Math.floor(t/4294967296));case 4:this.writeU8(t>>24);case 3:this.writeU8(t>>16);case 2:this.writeU8(t>>8);case 1:this.writeU8(t);break;default:throw new Error("Bad UINT size "+r)}}measureUnsignedInt(t){return t<1<<8?1:t<1<<16?2:t<1<<24?3:t<4294967296?4:5}getAsDataArray(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw new Error("ArrayBufferDataStream's pos lies beyond end of buffer")}};D.prototype.writeU8=D.prototype.writeByte});var it,at,lt=N(()=>{it=null,at=class{constructor(t){let r=[],a=Promise.resolve(),d=null,B=null;t&&t.constructor.name==="FileWriter"?d=t:it&&t&&(B=t),this.pos=0,this.length=0;function h(l){return new Promise(function(i,x){let w=new FileReader;w.addEventListener("loadend",function(){i(w.result)}),w.readAsArrayBuffer(l)})}function u(l){return new Promise(function(i,x){l instanceof Uint8Array?i(l):l instanceof ArrayBuffer||ArrayBuffer.isView(l)?i(new Uint8Array(l)):l instanceof Blob?i(h(l).then(function(w){return new Uint8Array(w)})):i(h(new Blob([l])).then(function(w){return new Uint8Array(w)}))})}function m(l){let i=l.byteLength||l.length||l.size;if(!Number.isInteger(i))throw new Error("Failed to determine size of element");return i}this.seek=function(l){if(l<0)throw new Error("Offset may not be negative");if(isNaN(l))throw new Error("Offset may not be NaN");if(l>this.length)throw new Error("Seeking beyond the end of file is not allowed");this.pos=l},this.write=function(l){let i={offset:this.pos,data:l,length:m(l)},x=i.offset>=this.length;this.pos+=i.length,this.length=Math.max(this.length,this.pos),a=a.then(function(){if(B)return new Promise(function(w,C){u(i.data).then(function(A){let g=0,E=Buffer.from(A.buffer),k=function(T,y,p){g+=y,g>=p.length?w():it.write(B,p,g,p.length-g,i.offset+g,k)};it.write(B,E,0,E.length,i.offset,k)})});if(d)return new Promise(function(w,C){d.onwriteend=w,d.seek(i.offset),d.write(new Blob([i.data]))});if(!x)for(let w=0;w<r.length;w++){let C=r[w];if(!(i.offset+i.length<=C.offset||i.offset>=C.offset+C.length)){if(i.offset<C.offset||i.offset+i.length>C.offset+C.length)throw new Error("Overwrite crosses blob boundaries");if(i.offset==C.offset&&i.length==C.length){C.data=i.data;return}else return u(C.data).then(function(A){return C.data=A,u(i.data)}).then(function(A){i.data=A,C.data.set(i.data,i.offset-C.offset)})}}r.push(i)})},this.complete=function(l){return B||d?a=a.then(function(){return null}):a=a.then(function(){let i=[];for(let x=0;x<r.length;x++)i.push(r[x].data);return new Blob(i,{type:l})}),a}}}});function Et(e,t){let r={};return[e,t].forEach(function(a){for(let d in a)Object.prototype.hasOwnProperty.call(a,d)&&(r[d]=a[d])}),r}function Tt(e){if(typeof e!="string"||!e.match(/^data:image\/webp;base64,/i))throw new Error("Failed to decode WebP Base64 URL");return window.atob(e.substring("data:image/webp;base64,".length))}function ft(e,t){let r=typeof e=="string"&&/^data:image\/webp/.test(e)?e:e.toDataURL("image/webp",t);return Tt(r)}function At(e){let t=e.charCodeAt(0),r=e.charCodeAt(1),a=e.charCodeAt(2),d=e.charCodeAt(3);return(t|r<<8|a<<16|d<<24)>>>0}function ut(e){let t=e.indexOf("VP8",12);if(t===-1)throw new Error("Bad image format, does this browser support WebP?");let r=!1;for(;t<e.length-8;){let a,d;switch(d=e.substring(t,t+4),t+=4,a=At(e.substring(t,t+4)),t+=4,d){case"VP8 ":return{frame:e.substring(t,t+a),hasAlpha:r};case"ALPH":r=!0;break}t+=a,(a&1)!==0&&t++}throw new Error("Failed to find VP8 keyframe in WebP image, is this image mistakenly encoded in the Lossless WebP format?")}function vt(e){this.value=e}function ct(e){this.value=e}function j(e,t,r){if(Array.isArray(r))for(let a=0;a<r.length;a++)j(e,t,r[a]);else if(typeof r=="string")e.writeString(r);else if(r instanceof Uint8Array)e.writeBytes(r);else if(r.id)if(r.offset=e.pos+t,e.writeUnsignedIntBE(r.id),Array.isArray(r.data)){let a,d,B;r.size===-1?e.writeByte(255):(a=e.pos,e.writeBytes([0,0,0,0])),d=e.pos,r.dataOffset=d+t,j(e,t,r.data),r.size!==-1&&(B=e.pos,r.size=B-d,e.seek(a),e.writeEBMLVarIntWidth(r.size,4),e.seek(B))}else if(typeof r.data=="string")e.writeEBMLVarInt(r.data.length),r.dataOffset=e.pos+t,e.writeString(r.data);else if(typeof r.data=="number")r.size||(r.size=e.measureUnsignedInt(r.data)),e.writeEBMLVarInt(r.size),r.dataOffset=e.pos+t,e.writeUnsignedIntBE(r.data,r.size);else if(r.data instanceof ct)e.writeEBMLVarInt(8),r.dataOffset=e.pos+t,e.writeDoubleBE(r.data.value);else if(r.data instanceof vt)e.writeEBMLVarInt(4),r.dataOffset=e.pos+t,e.writeFloatBE(r.data.value);else if(r.data instanceof Uint8Array)e.writeEBMLVarInt(r.data.byteLength),r.dataOffset=e.pos+t,e.writeBytes(r.data);else throw new Error("Bad EBML datatype "+typeof r.data);else throw new Error("Bad EBML datatype "+typeof r.data)}var Y,ht=N(()=>{dt();lt();Y=class{constructor(t){let r=5e3,a=1,d=!1,B=0,h=0,u=null,m=null,l=null,i=[],x=0,w=0,C={quality:.95,transparent:!1,alphaQuality:void 0,fileWriter:null,fd:null,frameDuration:null,frameRate:null},A={Cues:{id:new Uint8Array([28,83,187,107]),positionEBML:null},SegmentInfo:{id:new Uint8Array([21,73,169,102]),positionEBML:null},Tracks:{id:new Uint8Array([22,84,174,107]),positionEBML:null}},g,E={id:17545,data:new ct(0)},k,T=[],y=new at(t.fileWriter||t.fd);function p(n){return n-g.dataOffset}function U(n){(u===null||u.width!==n.width||u.height!==n.height)&&(u=document.createElement("canvas"),u.width=n.width,u.height=n.height,m=u.getContext("2d"),l=m.createImageData(u.width,u.height));let f=n.getContext("2d"),v=f.getImageData(0,0,n.width,n.height).data,c=l.data,L=0,R=n.width*n.height*4;for(let Q=3;Q<R;Q+=4){let q=v[Q];c[L++]=q,c[L++]=q,c[L++]=q,c[L++]=255}return m.putImageData(l,0,0),u}function _(){let n={id:21420,size:5,data:0},f={id:290298740,data:[]};for(let v in A){let c=A[v];c.positionEBML=Object.create(n),f.data.push({id:19899,data:[{id:21419,data:c.id},c.positionEBML]})}return f}function F(){k=_();let n={id:440786851,data:[{id:17030,data:1},{id:17143,data:1},{id:17138,data:4},{id:17139,data:8},{id:17026,data:"webm"},{id:17031,data:2},{id:17029,data:2}]},f={id:357149030,data:[{id:2807729,data:1e6},{id:19840,data:"webm-writer-js"},{id:22337,data:"webm-writer-js"},E]},v=[{id:176,data:B},{id:186,data:h}];t.transparent&&v.push({id:21440,data:1});let c={id:374648427,data:[{id:174,data:[{id:215,data:a},{id:29637,data:a},{id:156,data:0},{id:2274716,data:"und"},{id:134,data:"V_VP8"},{id:2459272,data:"VP8"},{id:131,data:1},{id:224,data:v}]}]};g={id:408125543,size:-1,data:[k,f,c]};let L=new D(256);j(L,y.pos,[n,g]),y.write(L.getAsDataArray()),A.SegmentInfo.positionEBML.data=p(f.offset),A.Tracks.positionEBML.data=p(c.offset),d=!0}function G(n){let f,v,c=new D(1+2+1);if(!(n.trackNumber>0&&n.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return c.writeEBMLVarInt(n.trackNumber),c.writeU16BE(n.timecode),c.writeByte(0),f={id:161,data:[c.getAsDataArray(),n.frame]},v={id:30113,data:[{id:166,data:[{id:238,data:1},{id:165,data:n.alpha}]}]},{id:160,data:[f,v]}}function W(n){let f=new D(1+2+1);if(!(n.trackNumber>0&&n.trackNumber<127))throw new Error("TrackNumber must be > 0 and < 127");return f.writeEBMLVarInt(n.trackNumber),f.writeU16BE(n.timecode),f.writeByte(1<<7),{id:163,data:[f.getAsDataArray(),n.frame]}}function O(n){return n.alpha?G(n):W(n)}function I(n){return{id:524531317,data:[{id:231,data:Math.round(n.timecode)}]}}function z(n,f,v){T.push({id:187,data:[{id:179,data:f},{id:183,data:[{id:247,data:n},{id:241,data:p(v)}]}]})}function tt(){let n={id:475249515,data:T},f=new D(16+T.length*32);j(f,y.pos,n),y.write(f.getAsDataArray()),A.Cues.positionEBML.data=p(n.offset)}function K(){if(i.length===0)return;let n=0;for(let c=0;c<i.length;c++)n+=i[c].frame.length+(i[c].alpha?i[c].alpha.length:0);let f=new D(n+i.length*64),v=I({timecode:Math.round(x)});for(let c=0;c<i.length;c++)v.data.push(O(i[c]));j(f,y.pos,v),y.write(f.getAsDataArray()),z(a,Math.round(x),v.offset),i=[],x+=w,w=0}function et(){if(!t.frameDuration)if(t.frameRate)t.frameDuration=1e3/t.frameRate;else throw new Error("Missing required frameDuration or frameRate setting");t.quality=Math.max(Math.min(t.quality,.99999),0),t.alphaQuality===void 0?t.alphaQuality=t.quality:t.alphaQuality=Math.max(Math.min(t.alphaQuality,.99999),0)}function rt(n){n.trackNumber=a,n.timecode=Math.round(w),i.push(n),w+=n.duration,w>=r&&K()}function X(){let n=new D(k.size),f=y.pos;j(n,k.dataOffset,k.data),y.seek(k.dataOffset),y.write(n.getAsDataArray()),y.seek(f)}function V(){let n=new D(8),f=y.pos;n.writeDoubleBE(x),y.seek(E.dataOffset),y.write(n.getAsDataArray()),y.seek(f)}this.addFrame=function(n,f,v){d||(B=n.width||0,h=n.height||0,F());let c=ut(ft(n,t.quality)),L,R=null;v?L=v:typeof f=="number"?L=f:L=t.frameDuration,t.transparent&&(f instanceof HTMLCanvasElement||typeof f=="string"?R=f:c.hasAlpha&&(R=U(n))),rt({frame:c.frame,duration:L,alpha:R?ut(ft(R,t.alphaQuality)).frame:null})},this.complete=function(){return d||F(),K(),tt(),X(),V(),y.complete("video/webm")},this.getWrittenSize=function(){return y.length},t=Et(C,t||{}),et()}}});function pt(e){return String("0000000"+e).slice(-7)}function Lt(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function M(e){let t={};this.settings=e,this.on=function(r,a){t[r]=a},this.emit=function(r){let a=t[r];a&&a.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=e.name||Lt(),this.extension="",this.mimeType=""}function H(e){M.call(this,e),this.quality=e.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=e.framerate,this.frames=0,this.part=1,this.videoWriter=new Y({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}function Z(e){M.call(this,e),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function nt(e){M.call(this,e),e.quality=31-(e.quality*30/100||10),e.workers=e.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:e.workers,quality:e.quality,workerScript:e.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){let r=this.callback;r&&(this.callback=void 0,r(t))}.bind(this))}function mt(e){let t=e||{},r,a,d,B,h,u,m=[],l=[],i=0,x=0,w=[],C=!1,A={};t.framerate=t.framerate||60,t.motionBlurFrames=2*(t.motionBlurFrames||1),r=t.verbose||!1,t.step=1e3/t.framerate,t.timeLimit=t.timeLimit||0,t.frameLimit=t.frameLimit||0,t.startTime=t.startTime||0;let g=document.createElement("div");g.style.position="absolute",g.style.left=g.style.top=0,g.style.backgroundColor="black",g.style.fontFamily="monospace",g.style.fontSize="11px",g.style.padding="5px",g.style.color="red",g.style.zIndex=1e5,t.display&&document.body.appendChild(g);let E=document.createElement("canvas"),k=E.getContext("2d"),T,y;S("Step is set to "+t.step+"ms");let p={webm:H,"webm-mediarecorder":Z},U=p[t.format];if(!U)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(p).join(", ");if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){let s=Date.now();performance.timing&&performance.timing.navigationStart&&(s=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-s}}let _=window.setTimeout,F=window.setInterval,G=window.clearInterval,W=window.clearTimeout,O=window.requestAnimationFrame,I=window.Date.now,z=window.performance.now,tt=window.Date.prototype.getTime,K=[];function et(){S("Capturer start"),d=window.Date.now(),a=d+t.startTime,h=window.performance.now(),B=h+t.startTime,window.Date.prototype.getTime=function(){return a},window.Date.now=function(){return a},window.setTimeout=function(o,b){let P={callback:o,time:b,triggerTime:a+b};return m.push(P),S("Timeout set to "+P.time),P},window.clearTimeout=function(o){for(let b=0;b<m.length;b++)if(m[b]==o){m.splice(b,1),S("Timeout cleared");continue}},window.setInterval=function(o,b){let P={callback:o,time:b,triggerTime:a+b};return l.push(P),S("Interval set to "+P.time),P},window.clearInterval=function(o){return S("clear Interval"),null},window.requestAnimationFrame=function(o){w.push(o)},window.performance.now=function(){return B};function s(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),K.push(this)),this._hookedTime+t.startTime}try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:s}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:s})}catch(o){S(o)}}function rt(){et(),u.start(),C=!0}function X(){C=!1,u.stop(),f()}function V(s,o){_(s,0,o)}function n(){V(q)}u=new U(t),u.step=n,u.on("process",q),u.on("progress",xt);function f(){S("Capturer stop"),window.setTimeout=_,window.setInterval=F,window.clearInterval=G,window.clearTimeout=W,window.requestAnimationFrame=O,window.Date.prototype.getTime=tt,window.Date.now=I,window.performance.now=z}function v(){let s=i/t.framerate;(t.frameLimit&&i>=t.frameLimit||t.timeLimit&&s>=t.timeLimit)&&(X(),ot());let o=new Date(null);o.setSeconds(s),t.motionBlurFrames>2?g.textContent="CCapture "+t.format+" | "+i+" frames ("+x+" inter) | "+o.toISOString().substr(11,8):g.textContent="CCapture "+t.format+" | "+i+" frames | "+o.toISOString().substr(11,8)}function c(s){(E.width!==s.width||E.height!==s.height)&&(E.width=s.width,E.height=s.height,T=new Uint16Array(E.height*E.width*4),k.fillStyle="#0",k.fillRect(0,0,E.width,E.height))}function L(s){k.drawImage(s,0,0),y=k.getImageData(0,0,E.width,E.height);for(let o=0;o<T.length;o+=4)T[o]+=y.data[o],T[o+1]+=y.data[o+1],T[o+2]+=y.data[o+2];x++}function R(){let s=y.data;for(let o=0;o<T.length;o+=4)s[o]=T[o]*2/t.motionBlurFrames,s[o+1]=T[o+1]*2/t.motionBlurFrames,s[o+2]=T[o+2]*2/t.motionBlurFrames;k.putImageData(y,0,0),u.add(E),i++,x=0,S("Full MB Frame! "+i+" "+a);for(let o=0;o<T.length;o+=4)T[o]=0,T[o+1]=0,T[o+2]=0;gc()}function Q(s){C&&(t.motionBlurFrames>2?(c(s),L(s),x>=.5*t.motionBlurFrames?R():n()):(u.add(s),i++,S("Full Frame! "+i)))}function q(){let s=1e3/t.framerate,o=(i+x/t.motionBlurFrames)*s;a=d+o,B=h+o,K.forEach(function(b){b._hookedTime=o/1e3}),v(),S("Frame: "+i+" "+x);for(let b=0;b<m.length;b++)if(a>=m[b].triggerTime){V(m[b].callback),m.splice(b,1);continue}for(let b=0;b<l.length;b++)if(a>=l[b].triggerTime){V(l[b].callback),l[b].triggerTime+=l[b].time;continue}w.forEach(function(b){V(b,a-kt)}),w=[]}function ot(s){s||(s=function(o){return J(o,u.filename+u.extension,u.mimeType),!1}),u.save(s)}function S(s){r&&console.log(s)}function bt(s,o){A[s]=o}function Bt(s){let o=A[s];o&&o.apply(null,Array.prototype.slice.call(arguments,1))}function xt(s){Bt("progress",s)}return{start:rt,capture:Q,stop:X,save:ot,on:bt}}var kt,wt=N(()=>{st();ht();kt=window.Date.now();M.prototype.start=function(){};M.prototype.stop=function(){};M.prototype.add=function(){};M.prototype.save=function(){};M.prototype.dispose=function(){};M.prototype.safeToProceed=function(){return!0};M.prototype.step=function(){console.log("Step not set!")};H.prototype=Object.create(M.prototype);H.prototype.start=function(e){this.dispose()};H.prototype.add=function(e){this.videoWriter.addFrame(e),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+pt(this.part),J(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+pt(this.part),this.step()}.bind(this)):(this.frames++,this.step())};H.prototype.save=function(e){this.videoWriter.complete().then(e)};H.prototype.dispose=function(e){this.frames=0,this.videoWriter=new Y({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})};Z.prototype=Object.create(M.prototype);Z.prototype.add=function(e){this.stream||(this.stream=e.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()};Z.prototype.save=function(e){this.mediaRecorder.onstop=function(t){let r=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],e(r)}.bind(this),this.mediaRecorder.stop()};nt.prototype=Object.create(M.prototype);nt.prototype.add=function(e){this.sizeSet||(this.encoder.setOption("width",e.width),this.encoder.setOption("height",e.height),this.sizeSet=!0),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()};nt.prototype.save=function(e){this.callback=e,this.encoder.render()}});var $,gt=N(()=>{wt();$=class{constructor(){this.active=!1,this.running=!1}enableCapture(t={}){this.active=!0,this.el=t.element||document.querySelector("canvas"),this.maxFrames=t.frameCount||600,this.capture=mt({framerate:t.frameRate||60,format:"webm",verbose:!1,display:!!t.display}),this.onComplete=t.onComplete||function(){}}startCapture(){this.active&&!this.running&&(this.capture.start(),this.frames=0,this.running=!0)}captureFrame(){this.active&&(this.capture.capture(this.el),this.frames++,this.frames>=this.maxFrames&&(console.log("[captureFrame] end"),this.capture.stop(),this.capture.save(),this.onComplete(),this.active=!1))}}});var Mt=Ct(yt=>{gt();if(window){let e=new $,t=e.enableCapture.bind(e),r=e.startCapture.bind(e),a=e.captureFrame.bind(e);if(window.p5){let d=window.p5;d.prototype.enableCapture=t,d.prototype.registerMethod("init",()=>{yt.enableCapture=t}),d.prototype.registerMethod("pre",()=>{r()}),d.prototype.registerMethod("post",()=>{try{a()}catch(B){console.error(B)}}),console.log("[webm-capture] registered with p5.js")}else console.error(["[webm-capture] ERROR! Could not find p5 object. Make sure the p5.js <script> tag is included in the page before p5.webm-capture."])}});Mt();})();
//# sourceMappingURL=p5.webm-capture.js.map
